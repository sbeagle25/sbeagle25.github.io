<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tooth 11 Test</title>
  <style>
    body {
      margin: 0;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
    }
    .chart {
      position: relative;
      background: url('teeth.png') no-repeat left top;
      background-size: auto;
      width: 1694px;
      height: 645px;
      margin-top: 20px;
    }
    .tooth-wrapper {
      position: absolute;
    }
    .tooth-wrapper img {
      position: absolute;
      top: 0;
      left: 0;
      display: none;
      pointer-events: auto;
      user-select: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="chart" id="chart"></div>

  <script>
    const chart = document.getElementById('chart');

    const t = { id: 11, top: 100, left: 100 }; // 只針對牙齒 11

    const states = ['crown', 'bridge', 'missing', 'implant'];
    const toothStates = { 11: { index: -1 } }; // 初始為 none
    const imgMap = { 11: {} };

    const wrapper = document.createElement('div');
    wrapper.className = 'tooth-wrapper';
    wrapper.style.top = t.top + 'px';
    wrapper.style.left = t.left + 'px';
    wrapper.dataset.tooth = t.id;
    chart.appendChild(wrapper);

    for (const state of states) {
      const suffix = { crown: 'c', bridge: 'b', missing: 'm', implant: 'i' }[state];
      const img = document.createElement('img');
      img.src = `/${state}/11${suffix}.png`;
      img.dataset.tooth = 11;
      img.dataset.state = state;
      img.addEventListener('click', (e) => {
        console.log(`Clicked on tooth 11`);
        nextState(11);
        e.stopPropagation();
      });
      wrapper.appendChild(img);
      imgMap[11][state] = img;
    }

    function nextState(id) {
      toothStates[id].index = (toothStates[id].index + 1) % (states.length + 1);
      updateToothDisplay(id);
    }

    function updateToothDisplay(id) {
      for (const state of states) {
        imgMap[id][state].style.display = 'none';
      }
      const currentIndex = toothStates[id].index;
      if (currentIndex >= 0) {
        const current = states[currentIndex];
        console.log(`Tooth ${id} state set to ${current}`);
        imgMap[id][current].style.display = 'block';
      } else {
        console.log(`Tooth ${id} state set to none`);
      }
    }
  </script>
</body>
</html>
